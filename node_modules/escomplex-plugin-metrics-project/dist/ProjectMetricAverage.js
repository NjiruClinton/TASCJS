'use strict';

Object.defineProperty(exports, "__esModule", {
   value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _ObjectUtil = require('typhonjs-escomplex-commons/dist/utils/ObjectUtil');

var _ObjectUtil2 = _interopRequireDefault(_ObjectUtil);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * ProjectMetricCalculate
 */
var ProjectMetricCalculate = function () {
   function ProjectMetricCalculate() {
      (0, _classCallCheck3.default)(this, ProjectMetricCalculate);
   }

   (0, _createClass3.default)(ProjectMetricCalculate, null, [{
      key: 'calculate',

      /**
       * Calculates average ModuleReport metrics that are applicable to ProjectReport.
       *
       * @param {object}   projectReport - The project report being processed.
       *
       * @private
       */
      value: function calculate(projectReport) {
         var divisor = projectReport.modules.length === 0 ? 1 : projectReport.modules.length;

         var moduleAverage = projectReport.moduleAverage;
         var moduleAverageKeys = _ObjectUtil2.default.getAccessorList(moduleAverage);

         // Defer to ModuleReport to sum all relevant module metrics applicable to ProjectResult.
         projectReport.modules.forEach(function (module) {
            moduleAverageKeys.forEach(function (averageKey) {
               var targetValue = _ObjectUtil2.default.safeAccess(module, averageKey, 0);
               _ObjectUtil2.default.safeSet(moduleAverage, averageKey, targetValue, 'add');
            });
         });

         moduleAverageKeys.forEach(function (averageKey) {
            _ObjectUtil2.default.safeSet(moduleAverage, averageKey, divisor, 'div');
         });
      }
   }]);
   return ProjectMetricCalculate;
}();

exports.default = ProjectMetricCalculate;
module.exports = exports['default'];